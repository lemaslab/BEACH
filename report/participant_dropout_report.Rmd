---
title: "Participant Dropout Report"
author: "Luran M."
date: "July 10, 2019"
output:
  html_document:
    highlight: tango
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
---

```{r setup, include=FALSE}

library(knitr, warn.conflicts = F, quietly = T)
library(tidyr, warn.conflicts = F, quietly = T)
library(dplyr, warn.conflicts = F, quietly = T)
library(ggplot2, warn.conflicts = F, quietly = T)
library(keyringr, warn.conflicts = F, quietly = T)
library(redcapAPI, warn.conflicts = F, quietly = T)
library(REDCapR, warn.conflicts = F, quietly = T)
library(lubridate, warn.conflicts = F, quietly = T)

#Create path to and api link to RedCaps
credential_label <- "beach_api"
credential_path <- paste(Sys.getenv("USERPROFILE"), '\\DPAPI\\passwords\\', Sys.info()["nodename"], '\\', credential_label, '.txt', sep="")
uri <- "https://redcap.ctsi.ufl.edu/redcap/api/"
beach_token<-decrypt_dpapi_pw(credential_path)

```

```{r variable selection, include=FALSE}

# Create connections
rcon <- redcapConnection(url=uri, token=beach_token)

# variables
desired_fields=c("test_id","redcap_event_name",
                 "beach_part_drop_out",
                 "beach_drop_reason",
                 "beach_last_visit",
                 "mom2wk_mod",
                 "mom3t_prepreg_bmi",
                 "inf2wk_delivery_location",
                 "mom3t_delivery_location")

# dropped participants
dropped.records.v1=c("BLS006A",
                     "BLS010A",
                     "BLS015A",
                     "BLS026A",
                     "BLS029A",
                     "BLS037A",
                     "BLS039A",
                     "BLS050A",
                     "BLS054A")

# pull data
dat<- redcap_read(
  batch_size=300,
  records= dropped.records.v1,
  redcap_uri = uri, 
  token      = beach_token, 
  fields     = desired_fields
  )$data

head(dat)
```

##Last visit completed by each participant:
```{r echo=FALSE}
last_visit<-dat%>%
  select(test_id,beach_part_drop_out,beach_last_visit)%>%
  filter(beach_part_drop_out==1)
```

##Mode of delivery for participant:
```{r echo=FALSE}
test<-dat%>%
  select(test_id,beach_part_drop_out)%>%
  filter(beach_part_drop_out==1)%>%
  distinct(test_id)
```

##Pre-pregnant BMI of dropped participants:


##Delivery Location of dropped participants:
###If empty, then dropped participant didn't provide location
